/* ========== TOKENS (always dark) ========== */
:root{
  --bg:#000; --bg-elev-1:#0B0B0C; --bg-elev-2:#111114; --bg-elev-3:#16161A;
  --surface-glass: rgba(255,255,255,.04);

  --text:#EDEFF2; --text-muted:#A5A7AE; --text-subtle:#868995;
  --accent:#4DD0E1; --accent-200:#74DCE8; --accent-700:#2D9AA8;
  --accent-blue:#60A5FA; --accent-cyan:#4DD0E1; --accent-violet:#9D7DFF; --accent-pink:#FF6BBA; --accent-lime:#A3E635;

  --ok:#23D18B; --warn:#F4B740; --bad:#FF5C58;
  --line:#1F2023;

  --shadow-sm: 0 1px 0 rgba(255,255,255,0.03), 0 1px 8px rgba(0,0,0,0.35);
  --shadow-md: 0 2px 0 rgba(255,255,255,0.04), 0 8px 30px rgba(0,0,0,0.45);
  --shadow-lg: 0 2px 0 rgba(255,255,255,0.03), 0 16px 60px rgba(0,0,0,0.55);

  --r-sm:10px; --r-md:16px; --r-lg:22px; --r-xl:28px; --r-full:999px;
  --sp-1:6px; --sp-2:10px; --sp-3:14px; --sp-4:18px; --sp-5:24px; --sp-6:32px;

  --font-ui: ui-sans-serif, system-ui, Inter, "SF Pro Display", Roboto, Arial, sans-serif;
  --size-xs:12px; --size-sm:13px; --size-md:15px; --size-lg:18px; --size-xl:24px; --size-2xl:32px; --size-3xl:42px;

  --chart-grid:#2A2B31; --chart-tick:#8E929B;
}
html,body{height:100%;background:var(--bg);color:var(--text);font-family:var(--font-ui);}
[data-theme="dark"]{ /* pin to dark */ }

/* ========== LAYOUT ========== */
.app-header{
  position:sticky; top:0; z-index:50;
  backdrop-filter: blur(10px);
  background:linear-gradient(180deg, rgba(0,0,0,.8), rgba(0,0,0,.4));
  border-bottom:1px solid var(--line);
}
.header-content{
  height:64px; display:flex; align-items:center; gap:var(--sp-4);
  padding:0 clamp(16px,3vw,32px);
}
.app-title{font-size:var(--size-lg); font-weight:650; letter-spacing:.3px;}
.nav-links{display:flex; gap:8px; margin-left:auto; margin-right:auto;}
.nav-link{padding:8px 12px; border-radius:var(--r-full); color:var(--text-muted); text-decoration:none; font-size:var(--size-sm); transition:.18s;}
.nav-link:hover{color:var(--text); background:rgba(255,255,255,.06);}
.nav-link.active{color:var(--accent-200); background:rgba(77,208,225,.12); box-shadow:inset 0 0 0 1px rgba(77,208,225,.25);}

.quick-actions{display:flex; gap:6px;}
.btn-ghost{
  display:inline-flex; align-items:center; justify-content:center;
  height:36px; width:36px; border-radius:var(--r-full);
  background:transparent; border:1px solid var(--line); color:var(--text);
  transition: background .18s ease, transform .12s ease;
}
.btn-ghost:hover{ background:rgba(255,255,255,.06); }
.btn-ghost:active{ transform: translateY(1px) scale(.98); }

.app-main{min-height:calc(100vh - 64px); padding: clamp(16px, 3vw, 28px); display:grid; gap:var(--sp-6);}
.app-main.narrow{ max-width:800px; margin:0 auto; }

/* Search */
.command-bar{
  display:flex; align-items:center; gap:10px;
  padding:12px 14px; border-radius:var(--r-full);
  background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
  border:1px solid var(--line); box-shadow:var(--shadow-sm);
}
.search-input{flex:1; background:transparent; color:var(--text); border:none; outline:none; font-size:var(--size-md);}
.pill{border-radius:var(--r-full); padding:8px 12px; background:rgba(77,208,225,.12); color:var(--accent-200); border:1px solid rgba(77,208,225,.35); transition:.18s;}
.pill:hover{ background:rgba(77,208,225,.18); }
.quick-city{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;}
.info-message{margin-top:8px; color:var(--text-subtle);}

/* Cards */
.ui-card{
  background:var(--surface-glass); border:1px solid var(--line);
  border-radius:var(--r-lg); box-shadow:var(--shadow-md);
  padding: clamp(16px, 3vw, 24px); position:relative; overflow:hidden;
}
.ui-card::after{
  content:""; position:absolute; inset:-1px; pointer-events:none;
  background: radial-gradient(600px 200px at 100% -10%, rgba(77,208,225,.08), transparent 60%);
}
.title{ font-size:var(--size-sm); color:var(--text-muted); letter-spacing:.3px; margin-bottom:10px; }

/* Overview Grid */
.overview-grid{ display:grid; gap:var(--sp-5); grid-template-columns: repeat(12, minmax(0,1fr)); }
.current-weather-card{ grid-column: span 5; display:grid; gap:14px; }
.weather-metrics{ grid-column: span 4; }
.sun-times-card{ grid-column: span 3; display:grid; gap:var(--sp-3); }
@media (max-width:1100px){
  .current-weather-card, .weather-metrics, .sun-times-card{ grid-column:1/-1; }
}

.cw-head{ display:flex; gap:14px; align-items:center; }
.cw-meta .text-subtle{ color:var(--text-subtle); }
.cw-temp{ font-size: clamp(48px, 6vw, 72px); font-weight:700; line-height:1; display:flex; gap:12px; align-items:baseline;}
.badge{ font-size:var(--size-sm); color:var(--text-muted); border:1px solid var(--line); border-radius:var(--r-full); padding:2px 8px; }

.metrics-grid{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px; }
.metric-card{
  display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:10px;
  padding:12px; border-radius:var(--r-md); border:1px solid var(--line); background:rgba(255,255,255,.03);
}
.progress-bar{ grid-column:1/-1; height:6px; border-radius:8px; background:#1C1D21; overflow:hidden;}
.progress-bar > i{ display:block; height:100%; width:var(--w,0%); background:linear-gradient(90deg, var(--accent-700), var(--accent-200)); }

.wind-direction i{ display:inline-block; transform: rotate(calc(var(--deg,0) * 1deg)); }
.dot{ display:inline-block; width:8px; height:8px; border-radius:50%; margin-right:6px; vertical-align:middle;}
.dot.ok{ background:var(--ok);} .dot.warn{ background:var(--warn);} .dot.bad{ background:var(--bad);}

/* Sun Times */
.sun-arc{ margin:var(--sp-3) 0; }
.sun-times{ display:grid; gap:var(--sp-2); }
.sunrise, .sunset{ display:flex; justify-content:space-between; align-items:center; font-size:var(--size-sm); }
.sunrise .label, .sunset .label{ color:var(--text-muted); }
.sunrise .time-value, .sunset .time-value{ color:var(--text); font-weight:500; }

/* Map */
.map-container{ padding:0; overflow:hidden; }
.segmented{ display:inline-flex; gap:6px; margin:16px; padding:6px; background:rgba(255,255,255,.06); border:1px solid var(--line); border-radius:var(--r-full); }
.seg-btn{ padding:8px 14px; border-radius:var(--r-full); background:transparent; color:var(--text-muted); border:0; cursor:pointer; transition:.18s; }
.seg-btn.active{ color:#fff; background:var(--accent); }
.seg-btn:hover{ color:var(--text); }
#weather-map{ height:400px; border-radius:var(--r-lg); }
.location-marker{ z-index:1000; }
.map-legend{ padding:16px; color:var(--text-subtle); font-size:var(--size-sm); }

/* Hourly */
.chart-container{ padding:var(--sp-5); height:200px; position:relative; }
.chart-container canvas{ width:100% !important; height:100% !important; }
.card-head{ display:flex; justify-content:space-between; align-items:center; margin-bottom:var(--sp-4); }
.controls{ display:flex; gap:6px; }
.range-toggle{ height:32px; padding:0 12px; font-size:var(--size-sm); }

/* Daily */
.forecast-grid{ display:grid; grid-template-columns:repeat(auto-fit, minmax(120px, 1fr)); gap:var(--sp-3); }
.forecast-day{
  display:grid; gap:8px; padding:var(--sp-3); border-radius:var(--r-md);
  border:1px solid var(--line); background:rgba(255,255,255,.03); text-align:center;
}
.day-icon{ width:32px; height:32px; margin:0 auto; }
.day-temps{ display:flex; justify-content:space-between; font-size:var(--size-sm); }
.max{ color:var(--text); } .min{ color:var(--text-muted); }

/* Settings Section */
.settings-grid{ display:grid; gap:var(--sp-5); }
.setting-group{ 
  padding:var(--sp-4); border-radius:var(--r-md); 
  border:1px solid var(--line); background:rgba(255,255,255,.03);
}
.group-title{ font-size:var(--size-sm); color:var(--text-muted); margin-bottom:var(--sp-3); letter-spacing:.3px; }
.unit-toggle, .theme-colors{ display:flex; gap:var(--sp-2); flex-wrap:wrap; }
.unit-btn, .color-btn{
  padding:var(--sp-2) var(--sp-3); border-radius:var(--r-md);
  background:rgba(255,255,255,.03); border:1px solid var(--line);
  color:var(--text); cursor:pointer; transition:.18s; font-size:var(--size-sm);
}
.unit-btn:hover, .color-btn:hover{ background:rgba(255,255,255,.06); }
.unit-btn.active, .color-btn.active{ background:var(--accent); color:#000; border-color:var(--accent); }

/* Status & Debug */
.status-badge{ margin-top:var(--sp-3); padding:var(--sp-2) var(--sp-3); background:rgba(255,255,255,.06); border-radius:var(--r-md); font-size:var(--size-sm); }
.debug-pre{ background:var(--bg-elev-2); padding:var(--sp-3); border-radius:var(--r-md); font-size:var(--size-xs); overflow-x:auto; margin:var(--sp-3) 0; }

/* Footer */
.site-footer{ text-align:center; padding:var(--sp-5); color:var(--text-muted); font-size:var(--size-sm); }

/* ========== ANIMATIONS ========== */
.reveal{ opacity:0; transform:translateY(20px); transition:opacity .6s ease, transform .6s ease; }
.reveal.revealed{ opacity:1; transform:translateY(0); }

.skeleton{ position:relative; overflow:hidden; }
.skeleton::before{
  content:""; position:absolute; inset:0; background:linear-gradient(90deg, transparent, rgba(255,255,255,.03), transparent);
  animation:shimmer 1.5s infinite;
}
@keyframes shimmer{ 0%{ transform:translateX(-100%); } 100%{ transform:translateX(100%); } }

/* ========== ICONS ========== */
.i{ display:inline-block; width:16px; height:16px; background:currentColor; mask-size:contain; mask-repeat:no-repeat; mask-position:center; }
.i-search{ mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'/%3E%3C/svg%3E"); }
.i-x{ mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 18L18 6M6 6l12 12'/%3E%3C/svg%3E"); }
.i-target{ mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'/%3E%3C/svg%3E"); }
.i-moon{ mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z'/%3E%3C/svg%3E"); }
.i-settings{ mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z'/%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15 12a3 3 0 11-6 0 3 3 0 016 0z'/%3E%3C/svg%3E"); }
.i-chevron-left{ mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15 19l-7-7 7-7'/%3E%3C/svg%3E"); }
.i-key{ mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z'/%3E%3C/svg%3E"); }
.i-arrow{ mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 7l5 5m0 0l-5 5m5-5H6'/%3E%3C/svg%3E"); }

/* ========== RESPONSIVE ========== */
@media (max-width:768px){
  .header-content{ padding:0 16px; }
  .nav-links{ display:none; }
  .app-main{ padding:16px; gap:var(--sp-4); }
  .overview-grid{ grid-template-columns:1fr; }
  .metrics-grid{ grid-template-columns:1fr; }
  .forecast-grid{ grid-template-columns:repeat(auto-fit, minmax(100px, 1fr)); }
  .settings-panel{ width:100%; right:-100%; }
}

/* ========== COMPATIBILITY ========== */
/* Map old selectors to new structure */
.search-container.command-bar{ display:flex; }
.search-input-group{ display:contents; }
.input-wrapper{ display:contents; }
.search-icon{ display:none; }
.clear-btn.btn-ghost{ height:32px; width:32px; }
.location-btn.pill{ height:auto; width:auto; }
.quick-city .pill{ height:auto; width:auto; }

/* Weather icon compatibility */
.weather-icon{ width:48px; height:48px; object-fit:contain; }

/* Chart container compatibility */
.chart-wrapper{ height:220px; }

/* Settings panel compatibility */
.settings-panel[hidden]{ right:-400px; }
.settings-panel:not([hidden]){ right:0; }

/* Focus visible */
button:focus-visible, a:focus-visible, input:focus-visible{ outline:none; box-shadow:0 0 0 3px rgba(77, 208, 225, 0.35); border-radius:8px; }